# bjw-s app-template values for SearxNG
app-template:
  controllers:
    main:
      annotations: {}
      containers:
        main:
          image:
            repository: searxng/searxng
            tag: latest
            pullPolicy: IfNotPresent
          env:
            # Non-sensitive literals
            INSTANCE_NAME: "SearxNG"
            BASE_URL: "https://searxng.eaglepass.io"
            SEARCH_DEFAULT_LANGUAGE: "en"
            # Sensitive envs via secretKeyRef (1Password Operator backed Secret named 'secrets')
            SECRET_KEY:
              valueFrom:
                secretKeyRef:
                  name: "secrets"
                  key: "secret-key"
            # Example engine keys (commented out by default)
            # GOOGLE_API_KEY:
            #   valueFrom:
            #     secretKeyRef:
            #       name: "secrets"
            #       key: "google-api-key"
            # BING_API_KEY:
            #   valueFrom:
            #     secretKeyRef:
            #       name: "secrets"
            #       key: "bing-api-key"
          envFrom:
            - secretRef:
                name: secrets
          # Probes (can be tuned as needed)
          probes:
            liveness:
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /
                  port: http
            readiness:
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /
                  port: http
            startup:
              enabled: false
          # Resources placeholder (tune per environment)
          resources: {}
  service:
    main:
      controller: main
      primary: true
      enabled: true
      type: ClusterIP
      annotations: {}
      ports:
        http:
          port: 8080
          protocol: HTTP
  ingress:
    main:
      enabled: true
      className: nginx
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
      hosts:
        - host: searxng.eaglepass.io
          paths:
            - path: /
              pathType: Prefix
              service:
                name: main
                port: http
      tls:
        - hosts:
            - searxng.eaglepass.io
          secretName: searxng-tls-certificate
  # Common pod options
  defaultPodOptions:
    securityContext: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}
    annotations:
      operator.1password.io/item-path: "vaults/4uaua4a45yuhnwhehp5bwylmti/items/zmzs6wc2wftouzhoaufk7eivdy"
      operator.1password.io/item-name: "secrets"
    labels: {}
  persistence:
    # ConfigMap-backed settings.yml (non-sensitive)
    config:
      enabled: true
      type: configMap
      name: searxng-config
      advancedMounts:
        main:
          main:
            - path: /etc/searxng/settings.yml
              subPath: settings.yml
    # Optional data persistence (disabled by default)
    data:
      enabled: true
      type: persistentVolumeClaim
      accessMode: ReadWriteOnce
      size: 1Gi
      storageClass: ""
      existingClaim: ""
      advancedMounts:
        main:
          main:
            - path: /data

# Non-sensitive configuration rendered into a ConfigMap
config:
  settingsYaml: |
    # Minimal example non-sensitive SearxNG configuration.
    server:
      port: 8080
      limiter: true
    ui:
      static_use_hash: true
    search:
      safe_search: 0

# Backups CronJob (only meaningful if persistence.data.enabled=true)
backups:
  enabled: false
  schedule: "*/15 * * * *"
  retentionDays: 7
  nfs:
    server: "10.0.50.3"
  path: "/exports/backups/searxng"
  annotations: {}
  resources: {}

