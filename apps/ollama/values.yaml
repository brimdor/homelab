# values.yaml for Ollama and Open WebUI

# --- Global Settings ---
fullnameOverride: ollama

imagePullSecrets: []

# --- Ollama Configuration ---
ollama:
  enabled: true
  name: ollama
  image:
    repository: docker.io/ollama/ollama
    tag: "0.3.5"
    pullPolicy: IfNotPresent  # Or Always, depending on your needs
  service:
    type: ClusterIP #Or LoadBalancer if you need external access
    port: 11434
  ingress:
    enabled: false #disabled by default, using a single ingress
  resources:
    requests:
      memory: 4Gi
      cpu: 2
    limits:
      memory: 8Gi # Adjust based on your resources
      cpu: 4
  persistence:
    enabled: true
    storageClass: "local-path"  # Replace with your storage class
    size: 200Gi

# --- Open WebUI Configuration ---
openWebUI:
  enabled: true
  name: open-webui
  image:
    repository: ghcr.io/open-webui/open-webui
    tag: "latest"
    pullPolicy: IfNotPresent
  env:
    OLLAMA_BASE_URL: "http://ollama:11434" # Ensure ollama service is accessible
  service:
    type: ClusterIP #Or LoadBalancer if you need external access
    port: 8080
  ingress:
    enabled: false #disabled by default, using a single ingress
  resources:
    requests:
      memory: 2Gi
      cpu: 1
    limits:
      memory: 4Gi
      cpu: 2

# --- Ingress Configuration (Shared) ---
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    external-dns.alpha.kubernetes.io/target: "homelab-tunnel.eaglepass.io"
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
  hosts:
    - host: "ollama.eaglepass.io"
      paths:
        - path: "/"
          pathType: Prefix
          backend:
            service:
              name: ollama # Refers to the ollama service
              port:
                number: 11434
    - host: "ai.eaglepass.io"
      paths:
        - path: "/"
          pathType: Prefix
          backend:
            service:
              name: open-webui # Refers to the open-webui service
              port:
                number: 8080
  tls:
    - hosts:
        - "ollama.eaglepass.io"
        - "ai.eaglepass.io"
      secretName: "ollama-tls-certificate"
